<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Kumano Compass - ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f3f6fb;
      --card: #ffffff;
      --accent: #2563eb;
      --accent-soft: rgba(37, 99, 235, 0.06);
      --text-main: #020617;
      --text-sub: #6b7280;
      --radius-lg: 18px;
      --radius-md: 12px;
      --shadow-soft: 0 20px 40px rgba(15, 23, 42, 0.12);
      --border-subtle: rgba(148, 163, 184, 0.55);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #e0edff 0, #f3f6fb 50%, #e5ecf6 100%);
      color: var(--text-main);
    }

    .app-shell {
      max-width: 1120px;
      margin: 0 auto;
      padding: 82px 16px 32px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 20px;
      margin-bottom: 16px;
    }

    .brand {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .brand-title {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 0.05em;
    }

    .brand-sub {
      font-size: 12px;
      color: var(--text-sub);
      max-width: 520px;
      line-height: 1.6;
    }

    .header-actions {
      display: flex;
      gap: 8px;
      flex-shrink: 0;
    }

    .pill {
      font-size: 10px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.04);
      color: var(--text-sub);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.28);
    }

    .btn {
      border: none;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      background: rgba(15, 23, 42, 0.04);
      color: #0f172a;
      transition: background 0.16s ease-out, transform 0.08s ease-out, box-shadow 0.16s ease-out;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.16);
    }

    .btn-primary {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      color: #ffffff;
      box-shadow: 0 18px 36px rgba(37, 99, 235, 0.5);
    }

    .btn:hover {
      transform: translateY(-1px) scale(1.04);
      box-shadow: 0 16px 32px rgba(15, 23, 42, 0.25);
      background: rgba(15, 23, 42, 0.06);
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #2c6fff, #2053e3);
      box-shadow: 0 22px 42px rgba(37, 99, 235, 0.6);
    }

    .btn:active {
      transform: scale(0.96) translateY(1px);
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.2);
    }

    .btn-icon {
      width: 17px;
      height: 17px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
    }

    /* ã‚«ãƒ¼ãƒ‰ï¼ˆã€Œä½æ°‘ã®å£°ï¼ˆæœ€æ–°20ä»¶ï¼‰ã€ï¼‰ */
    .card {
      margin-top: 4px;
      background: rgba(255, 255, 255, 0.98);
      border-radius: 18px;
      padding: 16px 18px 18px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.18);
      border: 1px solid rgba(148, 163, 184, 0.38);
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right,
        rgba(59, 130, 246, 0.08),
        transparent 60%);
      pointer-events: none;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 10px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.06em;
    }

    .card-sub {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 2px;
      line-height: 1.5;
      max-width: 480px;
      white-space: normal; /* ãã¡ã‚“ã¨æŠ˜ã‚Šè¿”ã™ */
    }

    /* å³å´ã®å†èª­ã¿è¾¼ã¿ãƒœã‚¿ãƒ³ */
    .card-header .btn {
      white-space: nowrap;
    }

    /* ãƒ†ãƒ¼ãƒ–ãƒ« */
    .table-wrapper {
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      background: rgba(15, 23, 42, 0.02);

      /* 20ä»¶ã‚’è¶…ãˆã¦ã‚‚å…¨ä»¶è¡¨ç¤ºã—ã€æ å†…ã ã‘ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
      max-height: 60vh;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    thead {
      background: rgba(15, 23, 42, 0.04);
      border-bottom: 1px solid rgba(148, 163, 184, 0.4);
      position: sticky;
      top: 0;
      z-index: 2;
    }

    th, td {
      padding: 8px 10px;
      text-align: left;
      vertical-align: top;
    }

    th {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
      color: #6b7280;
      user-select: none;
    }

    tbody tr {
      background: #ffffff;
      transition: background 0.16s ease-out, transform 0.08s ease-out, box-shadow 0.16s ease-out;
    }

    tbody tr:nth-child(even) {
      background: #f9fafb;
    }

    tbody tr:hover {
      background: #eef4ff;
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.12);
    }

    td:first-child {
      border-left: 3px solid transparent;
    }

    tbody tr:hover td:first-child {
      border-left-color: rgba(37, 99, 235, 0.9);
    }

    .id-cell {
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      color: #6b7280;
      max-width: 180px;
      overflow-wrap: anywhere;
    }

    .text-main {
      font-size: 12px;
      line-height: 1.5;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 3px 7px;
      border-radius: 999px;
      font-size: 10px;
      font-weight: 500;
      gap: 6px;
    }

    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #0f172a;
    }

    .badge-category {
      background: rgba(37, 99, 235, 0.08);
      color: #1d4ed8;
    }

    .badge-sentiment {
      background: rgba(15, 23, 42, 0.04);
      color: var(--text-sub);
    }

    .badge-sentiment.positive {
      background: rgba(34, 197, 94, 0.08);
      color: #15803d;
    }

    .badge-sentiment.negative {
      background: rgba(248, 113, 113, 0.08);
      color: #b91c1c;
    }

    .badge-sentiment.neutral {
      background: rgba(148, 163, 184, 0.12);
      color: #4b5563;
    }

    .score-pill {
      display: inline-flex;
      align-items: baseline;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(15, 23, 42, 0.03);
      color: #0f172a;
    }

    .score-label {
      font-size: 10px;
      text-transform: uppercase;
      color: #6b7280;
    }

    .meta-row {
      font-size: 10px;
      color: #9ca3af;
      margin-top: 4px;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.12);
      margin-right: 4px;
    }

    .tag-dot {
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: rgba(148, 163, 184, 0.9);
    }

    .empty-state {
      padding: 18px;
      text-align: center;
      font-size: 12px;
      color: var(--text-sub);
    }

    .refresh-info {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 6px;
      display: flex;
      justify-content: flex-end;
      gap: 6px;
      align-items: center;
    }

    .pulse-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #22c55e;
      box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.6);
      animation: pulse 1.6s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34,197,94,0.6); }
      70% { transform: scale(1.5); box-shadow: 0 0 0 10px rgba(34,197,94,0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34,197,94,0); }
    }

    /* ===== ã‚¹ãƒãƒ›å°‚ç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´ (admin) ===== */
    @media (max-width: 768px) {
      /* å…¨ä½“ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ä½™ç™½ã‚’ã‚¹ãƒãƒ›ç”¨ã« */
      .app-shell {
        max-width: 100%;
        padding: 72px 10px 24px; /* ãƒŠãƒ“é«˜ã•ã‚’å°‘ã—æ¸›ã‚‰ã—ã¦è¦‹ã‚„ã™ã */
      }

      /* ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ãƒ˜ãƒƒãƒ€ãƒ¼ï¼šç¸¦ä¸¦ã³ï¼‹å°‘ã—å°ã•ã‚ */
      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
        margin-bottom: 10px;
      }

      .brand-title {
        font-size: 17px;
      }

      .brand-sub {
        font-size: 11px;
        max-width: 100%;
        line-height: 1.5;
      }

      .header-actions {
        width: 100%;
        justify-content: flex-start;
        flex-wrap: wrap;
        gap: 6px;
      }

      .header-actions .btn {
        font-size: 11px;
        padding: 7px 11px;
      }

      /* ã€Œä½æ°‘ã®å£°ï¼ˆæœ€æ–°20ä»¶ï¼‰ã€ã‚«ãƒ¼ãƒ‰ã‚’ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */
      .card {
        padding: 12px 10px 16px;
        border-radius: 14px;
      }

      .card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
        margin-bottom: 8px;
      }

      .card-title {
        font-size: 13px;
      }

      .card-sub {
        font-size: 11px;
        max-width: 100%;
      }

      .card-header .btn {
        align-self: flex-start;
        font-size: 11px;
        padding: 6px 10px;
      }

      /* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚‚å°‘ã—ã ã‘å°ã•ã */
      .table-wrapper {
        margin-top: 6px;
        border-radius: 12px;
      }

      table {
        font-size: 11px;
      }

      th,
      td {
        padding: 6px 4px;
      }

      /* ã‚¹ãƒãƒ›ã§ã¯IDåˆ—ã¯éè¡¨ç¤ºï¼ˆæ—¢å­˜ä»•æ§˜ç¶­æŒï¼‰ */
      .id-col {
        display: none;
      }
    }

    /* ==== Kumano Compass å…±é€šãƒŠãƒ“ãƒãƒ¼ ==================== */
    .kc-nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 64px;
      z-index: 1000;
      padding: 0 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top left,
                  rgba(226, 239, 255, 0.95),
                  rgba(255, 255, 255, 0.98));
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.10);
      border-bottom: 1px solid rgba(209, 213, 219, 0.7);
    }

    .kc-nav-inner {
      width: 100%;
      max-width: 1120px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .kc-nav-left {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
      cursor: pointer;
      padding: 6px 0;
      border: none;
      background: transparent;
    }

    .kc-nav-logo-dot {
      width: 24px;
      height: 24px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #ffffff 0, #93c5fd 35%, #2563eb 100%);
      box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.22);
      animation: kc-nav-breath 3.2s ease-in-out infinite;
    }

    .kc-nav-logo-text {
      display: flex;
      flex-direction: column;
    }

    .kc-nav-title {
      font-size: 16px;
      font-weight: 700;
      letter-spacing: 0.06em;
    }

    .kc-nav-sub {
      font-size: 11px;
      color: #6b7280;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .kc-nav-center {
      flex: 1;
      display: flex;
      justify-content: center;
      gap: 8px;
    }

    .kc-nav-link {
      position: relative;
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 12px;
      color: #4b5563;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: 1px solid rgba(148, 163, 184, 0.7); /* â† æ ç·šã¤ã‘ã‚‹ */
      background: rgba(255, 255, 255, 0.9);
      cursor: pointer;
      transition:
        background 0.18s ease-out,
        color 0.18s ease-out,
        transform 0.18s ease-out,
        border-color 0.18s ease-out;
    }

    .kc-nav-link::after {
      content: "";
      position: absolute;
      left: 14px;
      right: 14px;
      bottom: 4px;
      height: 2px;
      border-radius: 999px;
      background: rgba(37, 99, 235, 0.9);
      transform: scaleX(0);
      transform-origin: center;
      transition: transform 0.2s ease-out;
    }

    .kc-nav-link:hover {
      background: rgba(239, 246, 255, 0.95);
      border-color: rgba(59, 130, 246, 0.9); /* ãƒ›ãƒãƒ¼æ™‚ã«æ ã‚’å°‘ã—æ¿ƒã */
      transform: translateY(-1px);
    }

    .kc-nav-link:hover::after {
      transform: scaleX(1);
    }

    .kc-nav-link.active {
      background: rgba(219, 234, 254, 0.95);
      color: #1d4ed8;
      border-color: rgba(37, 99, 235, 1); /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã¯ã—ã£ã‹ã‚Šé’æ  */
    }

    .kc-nav-link.active::after {
      transform: scaleX(1);
    }

    .kc-nav-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .kc-nav-pill {
      font-size: 10px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.12);
      color: #6b7280;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .kc-nav-pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.35);
    }

    /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æŠ¼ã—ä¸‹ã’ç”¨ï¼ˆindex/adminã§ä½¿ã†ï¼‰ */
    .kc-nav-spacer {
      height: 72px;
    }

    /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */

    @keyframes kc-nav-slide-in {
      from {
        transform: translateY(-100%);
        opacity: 0;
      }
      to {
        transform: translateY(0%);
        opacity: 1;
      }
    }

    @keyframes kc-nav-breath {
      0% {
        transform: scale(1);
        box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.22);
      }
      50% {
        transform: scale(1.06);
        box-shadow: 0 0 0 8px rgba(37, 99, 235, 0.0);
      }
      100% {
        transform: scale(1);
        box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.22);
      }
    }

    /* === å…±é€šãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ï¼šã‚¹ãƒãƒ›ç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆè¦–èªæ€§é‡è¦–ï¼‰ === */
    @media (max-width: 768px) {
      .kc-nav {
        height: 70px;
        padding: 6px 10px;
      }

      .kc-nav-inner {
        align-items: center;
        gap: 6px;
      }

      .kc-nav-left {
        gap: 6px;
      }

      .kc-nav-logo-dot {
        width: 22px;
        height: 22px;
      }

      .kc-nav-title {
        font-size: 13px;
        letter-spacing: 0.03em;
      }

      /* èª¬æ˜æ–‡ã¯ã‚¹ãƒãƒ›ã§ã¯éè¡¨ç¤ºã«ã—ã¦ãƒŠãƒ“ã‚’ã‚¹ãƒƒã‚­ãƒª */
      .kc-nav-sub {
        display: none;
      }

      /* ä¸­å¤®ã‚¿ãƒ–ï¼š3ã¤ã‚’å‡ç­‰å¹…ã®å¤§ããªãƒœã‚¿ãƒ³ã«ã™ã‚‹ */
      .kc-nav-center {
        flex: 1;
        justify-content: space-between;
        gap: 4px;
      }

      .kc-nav-link {
        flex: 1;                     /* 3ã¤ã§æ¨ªå¹…ã‚’ç­‰åˆ† */
        justify-content: center;
        padding: 8px 4px;
        font-size: 11px;
      }

      /* ã“ã‚Œã¾ã§éš ã—ã¦ã„ãŸãƒ©ãƒ™ãƒ«ã‚‚ã‚¹ãƒãƒ›ã§è¡¨ç¤ºã—ã¦è¦–èªæ€§UP */
      .kc-nav-link span:last-child {
        display: inline;
      }

      /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ”ãƒ«ï¼ˆã‚ªãƒ³ãƒ©ã‚¤ãƒ³ï¼Supabaseé€£æºä¸­ï¼‰ã¯éš ã™ */
      .kc-nav-right .kc-nav-pill {
        display: none;
      }

      /* mapãƒšãƒ¼ã‚¸ãªã©ã®CTAãƒœã‚¿ãƒ³ã¯å°ã•ã‚ã«æ®‹ã™ */
      .kc-nav-right .kc-nav-cta {
        padding: 6px 10px;
        font-size: 11px;
      }

      /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æŠ¼ã—ä¸‹ã’é‡ã‚‚å°‘ã—å¢—ã‚„ã™ */
      .kc-nav-spacer {
        height: 78px;
      }
    }

  </style>
</head>
<body>
  <div class="app-shell">
    <section class="card">
      <div class="card-header">
        <div>
          <div class="card-title">ä½æ°‘ã®å£°ï¼ˆä¸€è¦§ï¼‰</div>
          <div class="card-sub">AIãŒè‡ªå‹•ä»˜ä¸ã—ãŸã‚«ãƒ†ã‚´ãƒªãƒ»æ„Ÿæƒ…ãƒ»é‡è¦åº¦ã‚¹ã‚³ã‚¢ã‚’ã¾ã¨ã‚ã¦ç¢ºèªã§ãã¾ã™ã€‚</div>
        </div>
        <button class="btn" onclick="loadVoices(true)">
          <span class="btn-icon">âŸ³</span>
          å†èª­ã¿è¾¼ã¿
        </button>
      </div>

      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th class="id-col">ID</th>
              <th>æŠ•ç¨¿å†…å®¹</th>
              <th>ã‚«ãƒ†ã‚´ãƒª</th>
              <th>æ„Ÿæƒ…</th>
              <th>é‡è¦åº¦ã‚¹ã‚³ã‚¢</th>
            </tr>
          </thead>
          <tbody id="voices-table">
            <tr>
              <td colspan="5" class="empty-state">
                ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™â€¦
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="refresh-info">
        <span class="pulse-dot"></span>
        <span id="lastUpdatedText">æ›´æ–°æ™‚åˆ»: å–å¾—ä¸­â€¦</span>
      </div>
    </section>
  </div>
    <div class="kc-nav">
    <div class="kc-nav-inner">
      <!-- å·¦ãƒ­ã‚´ï¼šã‚¯ãƒªãƒƒã‚¯ã§å…¥åŠ›ç”»é¢ã¸ -->
      <button
        class="kc-nav-left"
        type="button"
        onclick="window.location.href='/public/index.html'"
      >
        <div class="kc-nav-logo-dot"></div>
        <div class="kc-nav-logo-text">
          <div class="kc-nav-title">Kumano Compass</div>
          <div class="kc-nav-sub">ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
        </div>
      </button>

      <!-- ä¸­å¤®ã‚¿ãƒ–ï¼ˆå…±é€šãƒŠãƒ“ï¼‰ -->
      <div class="kc-nav-center">
        <button
          class="kc-nav-link"
          type="button"
          data-nav-href="/public/index.html"
          data-nav-key="input"
        >
          <span>ğŸ“</span><span>å…¥åŠ›</span>
        </button>
        <button
          class="kc-nav-link"
          type="button"
          data-nav-href="/admin"
          data-nav-key="admin"
        >
          <span>ğŸ“Š</span><span>ä¸€è¦§</span>
        </button>
        <button
          class="kc-nav-link"
          type="button"
          data-nav-href="/admin/map"
          data-nav-key="map"
        >
          <span>ğŸ—º</span><span>ãƒãƒƒãƒ—</span>
        </button>
      </div>

      <!-- å³å´ï¼šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º -->
      <div class="kc-nav-right">
        <div class="kc-nav-pill">
          <span class="kc-nav-pill-dot"></span>
          <span>Supabase é€£æºä¸­</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ã‚«ãƒ†ã‚´ãƒªã”ã¨ã®è‰²ï¼ˆä¸€éƒ¨ map.html ã¨æƒãˆã¦ã‚‚OKï¼‰
    const CATEGORY_COLORS = {
      "äº¤é€š": "#e53935",
      "åŒ»ç™‚": "#8e24aa",
      "é«˜é½¢åŒ–ãƒ»ç¦ç¥‰": "#3949ab",
      "å­è‚²ã¦ãƒ»æ•™è‚²": "#1e88e5",
      "è¦³å…‰": "#00897b",
      "å•†åº—è¡—ãƒ»åœ°åŸŸçµŒæ¸ˆ": "#43a047",
      "è‡ªç„¶ç’°å¢ƒ": "#f59e0b",
      "é˜²ç½ãƒ»æ´¥æ³¢": "#fb8c00",
      "è¡Œæ”¿ã‚µãƒ¼ãƒ“ã‚¹": "#6d4c41",
      "æœªåˆ†é¡": "#64748b",
    };

    function sentimentClass(sentiment) {
      if (!sentiment) return "";
      if (sentiment === "positive") return "positive";
      if (sentiment === "negative") return "negative";
      return "neutral";
    }

    function sentimentLabel(v) {
      if (!v.sentiment) return "-";
      const score = (v.sentiment_score ?? 0).toFixed(2);
      if (v.sentiment === "positive") return `ãƒã‚¸ãƒ†ã‚£ãƒ– ${score}`;
      if (v.sentiment === "negative") return `ãƒã‚¬ãƒ†ã‚£ãƒ– ${score}`;
      return `ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ©ãƒ« ${score}`;
    }

    function formatImportance(v) {
      if (typeof v.importance_score !== "number") return "-";
      return v.importance_score.toFixed(2);
    }

    function formatMeta(v) {
      const tags = [];
      if (v.area) tags.push(`<span class="tag"><span class="tag-dot"></span>${v.area}</span>`);

      // ç¨®é¡ï¼ˆä½æ°‘ / å­¦ç”Ÿ / è¦³å…‰å®¢ï¼‰
      if (v.source === "ivusa") {
        tags.push('<span class="tag"><span class="tag-dot"></span>å­¦ç”Ÿ</span>');
      } else if (v.source === "local") {
        tags.push('<span class="tag"><span class="tag-dot"></span>åœ°åŸŸã®æ–¹ã€…</span>');
      } else if (v.source === "tourist") {
        tags.push('<span class="tag"><span class="tag-dot"></span>è¦³å…‰å®¢</span>');
      }

      // è¿½åŠ å±æ€§ï¼ˆä»»æ„ï¼‰
      if (v.age) tags.push(`<span class="tag"><span class="tag-dot"></span>${v.age}</span>`);
      if (v.gender) tags.push(`<span class="tag"><span class="tag-dot"></span>${v.gender}</span>`);
      if (v.occupation) tags.push(`<span class="tag"><span class="tag-dot"></span>${v.occupation}</span>`);

      return tags.join("");
    }

    async function loadVoices(isManual = false) {
      const tbody = document.getElementById("voices-table");
      if (!isManual) {
        tbody.innerHTML = `<tr><td colspan="5" class="empty-state">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™â€¦</td></tr>`;
      }

      try {
        const res = await fetch("/admin/api/voices?limit=2000")
        if (!res.ok) {
          throw new Error(await res.text());
        }
        const voices = await res.json();

        if (!voices || voices.length === 0) {
          tbody.innerHTML = `<tr><td colspan="5" class="empty-state">ã¾ã ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ç¾åœ°ã§å…¥åŠ›ã—ãŸå†…å®¹ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</td></tr>`;
          return;
        }

        tbody.innerHTML = "";
        voices.forEach((v) => {
          const tr = document.createElement("tr");

          const idCell = document.createElement("td");
          idCell.className = "id-cell id-col";
          idCell.textContent = v.id ?? "-";

          const textCell = document.createElement("td");
          textCell.innerHTML = `
            <div class="text-main">${(v.raw_text ?? "").replace(/\n/g, "<br>")}</div>
            <div class="meta-row">
              ${formatMeta(v)}
            </div>
          `;

          const categoryCell = document.createElement("td");
          const catColor = CATEGORY_COLORS[v.category] || CATEGORY_COLORS["æœªåˆ†é¡"];
          categoryCell.innerHTML = `
            <span class="badge badge-category" style="border:1px solid ${catColor}33;">
              <span class="badge-dot" style="background:${catColor};"></span>
              ${v.category ?? "æœªåˆ†é¡"}
            </span>
          `;

          const sentimentCell = document.createElement("td");
          const sClass = sentimentClass(v.sentiment);
          sentimentCell.innerHTML = `
            <span class="badge badge-sentiment ${sClass}">
              ${sentimentLabel(v)}
            </span>
          `;

          const importanceCell = document.createElement("td");
          importanceCell.innerHTML = `
            <span class="score-pill">
              <span class="score-label">IMP</span>
              <span>${formatImportance(v)}</span>
            </span>
          `;

          tr.appendChild(idCell);
          tr.appendChild(textCell);
          tr.appendChild(categoryCell);
          tr.appendChild(sentimentCell);
          tr.appendChild(importanceCell);

          tbody.appendChild(tr);
        });

        // æ›´æ–°æ™‚åˆ»
        const now = new Date();
        document.getElementById("lastUpdatedText").textContent =
          `æ›´æ–°æ™‚åˆ»: ${now.toLocaleString("ja-JP")}`;
      } catch (err) {
        console.error(err);
        tbody.innerHTML = `<tr><td colspan="5" class="empty-state">ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</td></tr>`;
      }
    }

    // åˆå›ãƒ­ãƒ¼ãƒ‰
    loadVoices();
  </script>
</body>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const links = document.querySelectorAll(".kc-nav-link");
    if (!links.length) return;

    // ç¾åœ¨ã®ãƒ‘ã‚¹ã‚’å–å¾—ã—ã¦æœ«å°¾ã®ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚’å‰Šã‚‹ï¼ˆ/admin/ â†’ /adminï¼‰
    const rawPath = window.location.pathname || "/";
    const currentPath =
      rawPath.length > 1 ? rawPath.replace(/\/+$/, "") : rawPath;

    links.forEach((btn) => {
      const href = btn.getAttribute("data-nav-href");
      if (!href) return;

      const hrefNorm =
        href.length > 1 ? href.replace(/\/+$/, "") : href;

      // å®Œå…¨ä¸€è‡´ã—ãŸã¨ãã ã‘ active ã‚’ä»˜ä¸
      if (currentPath === hrefNorm) {
        btn.classList.add("active");
      }

      btn.addEventListener("click", () => {
        window.location.href = href;
      });
    });

    // ï¼ˆãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å¾Œã§å…¥ã‚ŒãŸã„å ´åˆç”¨ã®ãƒ•ãƒƒã‚¯ï¼‰
    const burger = document.querySelector(".kc-nav-burger");
    const mobileMenu = document.querySelector(".kc-nav-mobile-menu");
    if (burger && mobileMenu) {
      burger.addEventListener("click", () => {
        burger.classList.toggle("open");
        mobileMenu.classList.toggle("open");
      });

      mobileMenu.querySelectorAll("[data-nav-href]").forEach((item) => {
        item.addEventListener("click", () => {
          const href = item.getAttribute("data-nav-href");
          if (href) {
            window.location.href = href;
          }
        });
      });
    }
  });
</script>
</html>